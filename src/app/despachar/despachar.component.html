<p-dialog header="{{ getHeaderText() }}" [(visible)]="visible" (onShow)="onShow()" (onHide)="cerrarDialogo()" [modal]="true">
  <div class="p-fluid formgrid grid" *ngIf="!modoVisualizacion">
    <div class="field col-12">
      <label>Tipo de Despacho</label>
      <p-selectButton [options]="tiposDespacho" [(ngModel)]="tipoSeleccionado"
      optionLabel="name" (onChange)="cambiarTipoDespacho()">
      </p-selectButton>
    </div>
    <div class="field col-12">
      <label for="vinDropdown">Buscar VIN registrado</label>
      <p-dropdown
        inputId="vinDropdown"
        [options]="vinsRegistrados"
        [(ngModel)]="vinSeleccionado"
        optionLabel="vin"
        [panelStyle]="{ 'max-height': '200px' }"
        [style]="{ width: '100%' }"
        placeholder="Seleccione un VIN"
        (onChange)="seleccionarVin($event)"
        appendTo="body"
        [autoDisplayFirst]="false"
        [virtualScroll]="true"
        [virtualScrollItemSize]="34"
        [filter]="true"
        filterPlaceholder="Buscar VIN"
        [ngClass]="{'ng-invalid ng-dirty': intentoGuardar && mostrarErrorVin}"
      >
        <ng-template let-item pTemplate="item">
          <div class="flex align-items-center">
            <span>{{ item.vin }}</span>
          </div>
        </ng-template>
      </p-dropdown>
      <small *ngIf="intentoGuardar && mostrarErrorVin" class="p-error">Campo obligatorio</small>
    </div>
  </div>
  <div class="p-fluid formgrid grid">
    <div class="field col-12">
      <label>VIN</label>
      <input pInputText [(ngModel)]="despacho.vin" readonly styleClass="w-full" [ngClass]="{'ng-invalid ng-dirty': intentoGuardar && mostrarErrorVin}"/>
      <small *ngIf="intentoGuardar && mostrarErrorVin" class="p-error">Campo obligatorio</small>
    </div>
    <div class="field col-12 md:col-6">
      <label>Motorista</label>
      <input pInputText [(ngModel)]="despacho.motorista"
             [readonly]="modoVisualizacion" styleClass="w-full" [ngClass]="{'ng-invalid ng-dirty': intentoGuardar && mostrarErrorMotorista}"/>
      <small *ngIf="intentoGuardar && mostrarErrorMotorista" class="p-error">Campo obligatorio</small>
    </div>
    <div *ngIf="tipoSeleccionado.value==='DM'" class="field col-12 md:col-6">
      <label>N° de BL</label>
      <input pInputText [(ngModel)]="despacho.bl" [readonly]="modoVisualizacion" styleClass="w-full" [ngClass]="{'ng-invalid ng-dirty': intentoGuardar && mostrarErrorBl}"/>
      <small *ngIf="intentoGuardar && mostrarErrorBl" class="p-error">Campo obligatorio</small>
    </div>
    <div *ngIf="tipoSeleccionado.value==='DM'" class="field col-12 md:col-6">
      <label>DUCA</label>
      <input pInputText [(ngModel)]="despacho.duca" [readonly]="modoVisualizacion" styleClass="w-full" [ngClass]="{'ng-invalid ng-dirty': intentoGuardar && mostrarErrorDuca}"/>
      <small *ngIf="intentoGuardar && mostrarErrorDuca" class="p-error">Campo obligatorio</small>
    </div>
    <div *ngIf="tipoSeleccionado.value==='TRANSITO'" class="field col-12 md:col-6">
      <label>N° de BL</label>
      <input pInputText [(ngModel)]="despacho.copiaBL" [readonly]="modoVisualizacion" styleClass="w-full" [ngClass]="{'ng-invalid ng-dirty': intentoGuardar && mostrarErrorCopiaBl}"/>
      <small *ngIf="intentoGuardar && mostrarErrorCopiaBl" class="p-error">Campo obligatorio</small>
    </div>
    <div *ngIf="tipoSeleccionado.value==='TRANSITO'" class="field col-12 md:col-6">
      <label>Tarja</label>
      <input pInputText [(ngModel)]="despacho.tarja" [readonly]="modoVisualizacion" styleClass="w-full" [ngClass]="{'ng-invalid ng-dirty': intentoGuardar && mostrarErrorTarja}"/>
      <small *ngIf="intentoGuardar && mostrarErrorTarja" class="p-error">Campo obligatorio</small>
    </div>
    <div *ngIf="tipoSeleccionado.value==='TRANSITO'" class="field col-12 md:col-6">
      <label>DUCA</label>
      <input pInputText [(ngModel)]="despacho.duca"
             [readonly]="modoVisualizacion" styleClass="w-full" [ngClass]="{'ng-invalid ng-dirty': intentoGuardar && mostrarErrorDuca}"/>
      <small *ngIf="intentoGuardar && mostrarErrorDuca" class="p-error">Campo obligatorio</small>
    </div>
    <div class="field col-12">
      <label for="observaciones">Observaciones</label>
      <textarea
        id="observaciones"
        pInputTextarea
        style="height: 200px; resize: none; overflow: auto; width: 100%;" rows="1"
        [(ngModel)]="despacho.observaciones"
        name="observaciones" [disabled]="modoVisualizacion" class="w-full">
      </textarea>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <p-button label="Cerrar" icon="pi pi-times" class="p-button-text" (click)="cerrarDialogo()">
    </p-button>
    <p-button *ngIf="!modoVisualizacion" label="Guardar" icon="pi pi-check" (click)="onGuardar()" [disabled]="!formularioValido()">
    </p-button>
  </ng-template>
</p-dialog>
