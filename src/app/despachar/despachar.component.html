<p-dialog
  header="Despacho de Vehiculos"
  [(visible)]="visible"
  (onShow)="onShow()"
  (onHide)="cerrarDialogo()"
  [modal]="true"
  [style]="{ width: '50vw' }">

  <form [formGroup]="despachoForm" class="p-fluid formgrid grid">
    <!-- Tipo de Salida -->
    <div class="field col-12">
      <label>Tipo de Despacho</label>
      <p-selectButton
        formControlName="tipoSalida"
        [options]="tiposDespacho"
        optionLabel="name"
        optionValue="value"
        class="w-full">
      </p-selectButton>
      <small *ngIf="despachoForm.get('tipoSalida')?.invalid && despachoForm.get('tipoSalida')?.touched"
             class="p-error">
        Debes seleccionar DM o TRANSITO
      </small>
    </div>

    <!-- Autocomplete VIN -->
    <div class="field col-12">
      <label>Buscar VIN registrado</label>
      <p-autoComplete
        formControlName="vin"
        [suggestions]="vinFiltrados"
        (completeMethod)="filtrarVins($event)"
        field="vin"
        [dropdown]="true"
        placeholder="Seleccione un VIN"
        (onSelect)="seleccionarVin($event)"
        class="w-full">
      </p-autoComplete>
      <small *ngIf="despachoForm.get('vin')?.invalid && despachoForm.get('vin')?.touched"
             class="p-error">
        VIN obligatorio
      </small>
    </div>

    <!-- Fecha despacho -->
    <div class="field col-6">
      <label>Fecha de despacho</label>
      <input
        pInputText type="date"
        formControlName="fechaDespacho"
        [attr.max]="todayISO"
        class="w-full"/>
      <small *ngIf="despachoForm.get('fechaDespacho')?.invalid && despachoForm.get('fechaDespacho')?.touched"
             class="p-error">
        Fecha requerida
      </small>
    </div>

    <!-- DUCA -->
    <div class="field col-6">
      <label>DUCA</label>
      <input pInputText formControlName="duca" class="w-full"/>
      <small *ngIf="despachoForm.get('duca')?.invalid && despachoForm.get('duca')?.touched"
             class="p-error">
        DUCA obligatorio
      </small>
    </div>

    <!-- Motorista -->
    <div class="field col-6">
      <label>Motorista</label>
      <input pInputText formControlName="motorista" class="w-full"/>
      <small *ngIf="despachoForm.get('motorista')?.invalid && despachoForm.get('motorista')?.touched"
             class="p-error">
        Motorista obligatorio
      </small>
    </div>

    <!-- Nota de Levante -->
    <div class="field col-6">
      <label>Nota de Levante</label>
      <input pInputText formControlName="notaDeLevante" class="w-full"/>
    </div>

    <!-- Observaciones -->
    <div class="field col-12">
      <label>Observaciones</label>
      <textarea
        formControlName="observaciones"
        pInputTextarea
        rows="4"
        class="w-full">
      </textarea>
    </div>
  </form>

  <ng-template pTemplate="footer">
    <p-button
      label="Cerrar"
      icon="pi pi-times"
      class="p-button-text"
      (click)="cerrarDialogo()">
    </p-button>
    <p-button
      label="Guardar"
      icon="pi pi-check"
      (click)="onGuardar()"
      [disabled]="despachoForm.invalid || modoVisualizacion">
    </p-button>
  </ng-template>
</p-dialog>
